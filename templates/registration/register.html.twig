{% extends 'base.html.twig' %}

{% block title %}Rejestracja - Fiszki AI{% endblock %}

{% block content %}
<twig:Card variant="elevated" class="p-6">
    {# Page Header #}
    <div class="mb-6 text-center">
        <h1 class="text-headline-large mb-2">Utwórz konto</h1>
        <p class="text-body-medium text-[var(--color-on-surface-variant)]">
            Zacznij tworzyć fiszki za pomocą AI
        </p>
    </div>

    {# Flash Messages #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="mb-6 p-4 {% if label == 'error' %}bg-[var(--color-error-container)] border-l-4 border-[var(--color-error)]{% else %}bg-[var(--color-primary-container)] border-l-4 border-[var(--color-primary)]{% endif %} rounded" role="alert">
                <p class="text-body-medium {% if label == 'error' %}text-[var(--color-on-error-container)]{% else %}text-[var(--color-on-primary-container)]{% endif %}">
                    {{ message }}
                </p>
            </div>
        {% endfor %}
    {% endfor %}

    {# Registration Form #}
    {{ form_start(registrationForm, {'attr': {'novalidate': 'novalidate', 'data-controller': 'form-validation'}}) }}

        <div class="space-y-4">
            {# Email Field #}
            <div>
                {{ form_widget(registrationForm.email, {
                    'attr': {
                        'class': 'w-full px-4 py-3 rounded-lg border border-[var(--color-outline)] bg-[var(--color-surface)] text-[var(--color-on-surface)]',
                        'placeholder': 'twój@email.pl',
                        'data-form-validation-target': 'email',
                        'data-action': 'blur->form-validation#validateEmail input->form-validation#validateEmailRealtime'
                    }
                }) }}
                <div data-form-validation-target="emailError" class="text-body-small text-[var(--color-error)] mt-1 hidden"></div>
                {{ form_errors(registrationForm.email, {
                    'attr': {
                        'class': 'text-body-small text-[var(--color-error)] mt-1'
                    }
                }) }}
            </div>

            {# Password Field #}
            <div>
                {{ form_widget(registrationForm.plainPassword, {
                    'attr': {
                        'class': 'w-full px-4 py-3 rounded-lg border border-[var(--color-outline)] bg-[var(--color-surface)] text-[var(--color-on-surface)]',
                        'placeholder': 'Minimum 8 znaków',
                        'data-form-validation-target': 'password',
                        'data-action': 'blur->form-validation#validatePassword input->form-validation#validatePasswordRealtime'
                    }
                }) }}
                <div data-form-validation-target="passwordError" class="text-body-small text-[var(--color-error)] mt-1 hidden"></div>
                {{ form_errors(registrationForm.plainPassword, {
                    'attr': {
                        'class': 'text-body-small text-[var(--color-error)] mt-1'
                    }
                }) }}

                {# Password Strength Indicator #}
                <div class="mt-2">
                    <div class="flex gap-1">
                        <div data-form-validation-target="strengthBar1" class="h-1 flex-1 bg-[var(--color-surface-variant)] rounded transition-colors"></div>
                        <div data-form-validation-target="strengthBar2" class="h-1 flex-1 bg-[var(--color-surface-variant)] rounded transition-colors"></div>
                        <div data-form-validation-target="strengthBar3" class="h-1 flex-1 bg-[var(--color-surface-variant)] rounded transition-colors"></div>
                        <div data-form-validation-target="strengthBar4" class="h-1 flex-1 bg-[var(--color-surface-variant)] rounded transition-colors"></div>
                    </div>
                    <p data-form-validation-target="strengthText" class="text-body-small text-[var(--color-on-surface-variant)] mt-1"></p>
                </div>
            </div>

            {# Password Confirmation Field #}
            <div>
                {{ form_widget(registrationForm.passwordConfirm, {
                    'attr': {
                        'class': 'w-full px-4 py-3 rounded-lg border border-[var(--color-outline)] bg-[var(--color-surface)] text-[var(--color-on-surface)]',
                        'placeholder': 'Wpisz hasło ponownie',
                        'data-form-validation-target': 'passwordConfirm',
                        'data-action': 'blur->form-validation#validatePasswordMatch input->form-validation#validatePasswordMatchRealtime'
                    }
                }) }}
                <div data-form-validation-target="passwordConfirmError" class="text-body-small text-[var(--color-error)] mt-1 hidden"></div>
                {{ form_errors(registrationForm.passwordConfirm, {
                    'attr': {
                        'class': 'text-body-small text-[var(--color-error)] mt-1'
                    }
                }) }}
            </div>

            {# Terms Acceptance #}
            <div class="flex items-start gap-2 pt-2">
                {{ form_widget(registrationForm.agreeTerms, {
                    'attr': {
                        'class': 'mt-1',
                        'data-form-validation-target': 'terms',
                        'data-action': 'change->form-validation#updateSubmitButtonState'
                    }
                }) }}
                <label for="{{ registrationForm.agreeTerms.vars.id }}" class="text-body-small text-[var(--color-on-surface-variant)]">
                    Akceptuję
                    <a href="#" class="text-[var(--color-primary)] hover:underline">regulamin</a>
                    i
                    <a href="#" class="text-[var(--color-primary)] hover:underline">politykę prywatności</a>
                </label>
            </div>
            {{ form_errors(registrationForm.agreeTerms, {
                'attr': {
                    'class': 'text-body-small text-[var(--color-error)] mt-1'
                }
            }) }}

            {# Submit Button #}
            <div class="pt-2">
                <button type="submit"
                        class="w-full px-6 py-3 bg-[var(--color-primary)] text-[var(--color-on-primary)] rounded-lg font-medium hover:opacity-90 transition-opacity"
                        data-form-validation-target="submitButton">
                    Utwórz konto
                </button>
            </div>
        </div>

    {{ form_end(registrationForm) }}

    {# Login Link #}
    <div class="mt-6 pt-6 border-t border-[var(--color-outline-variant)] text-center">
        <p class="text-body-medium text-[var(--color-on-surface-variant)]">
            Masz już konto?
            <a href="{{ path('app_login') }}"
               class="text-[var(--color-primary)] font-medium hover:underline">
                Zaloguj się
            </a>
        </p>
    </div>
</twig:Card>
{% endblock %}
